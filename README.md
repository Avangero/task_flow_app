# Task Flow API

Task Flow API - это RESTful API для управления проектами и задачами, построенное на Laravel 12. Система предоставляет функциональность для управления пользователями, проектами, задачами и статистикой с поддержкой JWT аутентификации.

**Техническое задание проекта можно найти в файле `SOW.md` в корне проекта.**

## Особенности

- JWT аутентификация и авторизация
- Управление пользователями с ролевой системой (admin, manager, user)
- Управление проектами и задачами
- Статистика и аналитика
- Email уведомления о изменениях статусов
- Фильтрация и поиск
- Покрытие тестами
- Docker поддержка

## Требования

- PHP 8.2+
- Composer
- Docker & Docker Compose
- Свободность порта 80, в случае если он занят изменить .env

## Установка и настройка

1. **Клонируйте репозиторий:**
```bash
git clone <repository-url>
cd task_flow_api
```
2. **Выдайте права на выполнение установочного скрипта:**
```bash
chmod +x install.sh
```

3. **Проверьте соответствие платформы требованиям и выполните запуск установочного скрипта:**
```bash
./install.sh
```

**Важно:** Установочный скрипт использует Docker и Docker Compose, убедитесь что Docker запущен.

## API Endpoints

Базовый URL: `http://localhost:8000/api`

### Аутентификация

| Метод | URL | Описание | Аутентификация |
|-------|-----|----------|----------------|
| POST | `/auth/register` | Регистрация пользователя | Нет |
| POST | `/auth/login` | Вход в систему | Нет |
| POST | `/auth/refresh` | Обновление токена | Нет |
| GET | `/auth/me` | Информация о текущем пользователе | JWT |
| POST | `/auth/logout` | Выход из системы | JWT |

### Пользователи

| Метод | URL | Описание | Аутентификация |
|-------|-----|----------|----------------|
| GET | `/users` | Список пользователей | JWT |
| GET | `/users/{id}` | Информация о пользователе | JWT |
| PUT | `/users/{id}` | Обновление пользователя | JWT |

### Проекты

| Метод | URL | Описание | Аутентификация |
|-------|-----|----------|----------------|
| GET | `/projects` | Список проектов | JWT |
| POST | `/projects` | Создание проекта | JWT |
| GET | `/projects/{id}` | Информация о проекте | JWT |
| PUT | `/projects/{id}` | Обновление проекта | JWT |
| DELETE | `/projects/{id}` | Удаление проекта | JWT |

### Задачи

| Метод | URL | Описание | Аутентификация |
|-------|-----|----------|----------------|
| GET | `/tasks` | Список задач | JWT |
| POST | `/tasks` | Создание задачи | JWT |
| GET | `/tasks/{id}` | Информация о задаче | JWT |
| PUT | `/tasks/{id}` | Обновление задачи | JWT |
| DELETE | `/tasks/{id}` | Удаление задачи | JWT |

### Статистика

| Метод | URL | Описание | Аутентификация |
|-------|-----|----------|----------------|
| GET | `/statistics` | Статистика по проектам и задачам | JWT |

## Тестирование

### Запуск всех тестов

```bash
./vendor/bin/sail artisan test
```

**Примечание:** Также тесты запускаются через GitHub при создании pull-request.

## Тестовые данные для входа

После выполнения `php artisan migrate:fresh --seed` в системе будут созданы следующие тестовые аккаунты:

### Администратор
- **Email:** `admin@taskflow.com`
- **Пароль:** `password`
- **Роль:** Administrator

### Менеджеры
- **Email:** `maria.petrova@taskflow.com` | **Пароль:** `password` | **Статус:** Активен
- **Email:** `dmitry.sidorov@taskflow.com` | **Пароль:** `password` | **Статус:** Активен
- **Email:** `elena.kozlova@taskflow.com` | **Пароль:** `password` | **Статус:** Неактивен

### Обычные пользователи
- **Email:** `anna.ivanova@taskflow.com` | **Пароль:** `password` | **Статус:** Активен
- **Email:** `sergey.volkov@taskflow.com` | **Пароль:** `password` | **Статус:** Активен
- **Email:** `olga.smirnova@taskflow.com` | **Пароль:** `password` | **Статус:** Активен
- **Email:** `mikhail.novikov@taskflow.com` | **Пароль:** `password` | **Статус:** Заблокирован
- **Email:** `tatyana.fedorova@taskflow.com` | **Пароль:** `password` | **Статус:** Активен

## Инструменты для тестирования

- В образе подняты контейнеры Mailpit и Queue. Это позволит проверить отправку писем прямо в браузере по адресу http://localhost:8025. 

## Коллекция Postman

Для удобства тестирования API вы можете импортировать готовую коллекцию Postman (не забудьте получить авторизационный токен и подставить его в заголовки):

1. Откройте Postman
2. Нажмите Import
3. Выберите файл `task_flow_api.postman_collection.json` из корня проекта

**Примечание:** Для удобства коллекция разбита на папки по сущностям для облегчения навигации.

## Структура проекта

```
app/
├── Enums/              # Перечисления (статусы, приоритеты)
├── Events/             # События приложения
├── Exceptions/         # Пользовательские исключения
├── Filters/            # Фильтры для запросов
├── Http/
│   ├── Controllers/    # API контроллеры
│   ├── Middleware/     # Middleware
│   ├── Requests/       # Валидация запросов
│   └── Resources/      # API ресурсы
├── Listeners/          # Обработчики событий
├── Mail/              # Email шаблоны
├── Models/            # Eloquent модели
├── Observers/         # Model observers
├── Policies/          # Политики авторизации
├── Repositories/      # Репозитории для работы с данными
└── Services/          # Бизнес-логика
```

## Разработка

### Code Style
```bash
# Проверка и исправление кода
./vendor/bin/duster fix

# Только проверка
./vendor/bin/duster lint
```

## Автор

**Александр Филин** - [@Avangero](https://github.com/Avangero)

## Лицензия

Этот проект лицензирован под [MIT License](https://opensource.org/licenses/MIT).
